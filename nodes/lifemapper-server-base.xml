<?xml version="1.0" standalone="no"?>

<kickstart>

	<description>
	Lifemapper-server roll. 
	LMserver and LMweb servers common install 
	</description>

	<copyright>
	Copyright (c) 2000 - 2012 The Regents of the University of California.
	All rights reserved. Rocks(r) v5.5/v6.0 www.rocksclusters.org
	</copyright>

	<changelog>
	</changelog>

        <!-- RPM repos needed for postgresql,postgis,mapserver -->
	<package>pgdg-centos91</package>
	<package>elgis-release</package>

	<!-- packages available on the system -->
	<package>flex</package>

	<!-- mapserver prereq -->
	<package>bitstream-vera-fonts-common</package>
	<package>bitstream-vera-sans-fonts</package>

	<!-- lifemapper prerequisites -->
	<package>lifemapper-proj</package>
	<package>lifemapper-geos</package>
	<package>lifemapper-gdal</package>
	<package>lifemapper-tiff</package>

	<!-- python prerequisites -->
	<package>opt-setuptools</package>
	<package>opt-numexpr</package>
	<package>opt-cython</package>
	<package>opt-pytables</package>
	<package>opt-egenix-mx-base</package>
	<package>opt-psycopg2</package>
	<package>opt-faulthandler</package>

	<package>lifemapper-server</package>
	<package>rocks-lifemapper</package>
	<package>roll-lifemapper-server-usersguide</package>

<post>

/sbin/ldconfig

yum --enablerepo base     install giflib-devel
yum --enablerepo base     install byacc
yum --enablerepo base     install readline-devel
yum --enablerepo base     install subversion
yum --enablerepo rpmforge install hdf4 hdf4-devel 
yum --enablerepo rpmforge install hdf5 hdf5-devel
yum --enablerepo base install cmake

# mapserver
yum --enablerepo epel install fribidi
yum --enablerepo elgis install mapserver

GID=`grep lmwriter: /etc/group`
if [ "$GID" == "" ] ; then
    /usr/sbin/groupadd -g 502 lmwriter
fi

</post>

<post>

mkdir -p /state/partition1/lmserver/data/AncillaryData
mkdir -p /state/partition1/lmserver/data/ArchiveData
mkdir -p /state/partition1/lmserver/data/UserData
chgrp -R lmwriter /state/partition1/lmserver/

for item in `/opt/lifemapper/lmserver/`; do
    chgrp -R g+ws /opt/lifemapper/lmserver/$item
done

<file name="/etc/auto.share" mode="append">
lmserver &Kickstart_PrivateHostname;:/export/&amp;
</file>

/etc/init.d/autofs restart

</post>

</kickstart>
