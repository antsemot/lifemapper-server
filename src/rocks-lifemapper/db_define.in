#!/bin/bash 

# Purpose: Define lifemapper DBs
#
# This scirpt is run by a superuser, it reads the @PKGROOT@/rocks/etc/users file
# to get the password for the "admin" DB user and runs psql to execute all the sql scripts


# set db user
USER=admin

# check if users file exists
if [ ! -f @PKGROOT@/rocks/etc/users ] ; then
    echo "Error: missing file @PKGROOT@/rocks/etc/users "
    exit 1
fi

# check who is running the scipt
cat @PKGROOT@/rocks/etc/users > /dev/null
RETVAL=$?
if [ $RETVAL -ne 0 ]; then
    echo "Error: You must be root to run this script." 
    exit 1
fi

# get the password from "users' file and execut sql commands
PASS=`grep admin @PKGROOT@/rocks/etc/users | awk '{print $2}'`
export PGPASSWORD=$PASS
psql -U admin -d template1 -f @LMHOME@/LmDbServer/dbsetup/runAllSQLScripts.sql


 
