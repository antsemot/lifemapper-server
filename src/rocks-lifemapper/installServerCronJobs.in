#!/bin/bash 
#
# Add scripts for scheduled tasks to cron.daily, cron.d directories. 
# Called by initLM.
#
usage () 
{
    echo "Usage: $0"
    echo "This script copies maintenance scripts to the cron directories and "
    echo "sets execute permissions."
}

### define varibles
setDefaults () {
    CRON_DIR=/etc/cron.d/
    CRON_DAILY_DIR=/etc/cron.daily/
    LOG=/tmp/`/bin/basename $0`.log
    gname=lmwriter
    touch $LOG
    TimeStamp "# Start"
}

TimeStamp () {
    echo $1 `/bin/date` >> $LOG
}

# install cron jobs (security, cleanup)
installDailyTasks () {
    # run daily 
    install @LMHOME@/config/securityUpdates.sh ${CRON_DAILY_DIR}
    install @LMHOME@/rocks/bin/deleteOldAnonymous ${CRON_DAILY_DIR}
    echo "Installed daily tasks to ${CRON_DAILY_DIR} ..." | tee -a $LOG
}

# install scheduled cron jobs (tests, solr)
installSchedTasks () {
    # run every X hours (hour interval in scripts)
    install @LMHOME@/rocks/bin/callLmServerTests ${CRON_DIR}
    install  @LMHOME@/rocks/bin/buildLmSolrIndex ${CRON_DIR}
    echo "Installed scheduled tasks to ${CRON_DIR} ..." | tee -a $LOG
}

#### Main ####
if [ $# -ne 0 ]; then
    usage
    exit 0
fi 

setDefaults
installDailyTasks
installSchedTasks
TimeStamp "# End"
